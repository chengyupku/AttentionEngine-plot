<?xml version="1.0"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg xmlns="http://www.w3.org/2000/svg">
<g font-family="monospace" font-size="14px">
<text x="0" y="14" xml:space="preserve"><tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: .5;">state</tspan>&#160;<tspan fill="#666666" style="fill-opacity: .5;">=</tspan>&#160;<tspan style="fill-opacity: .5;">initialize_state<tspan style="fill-opacity: .5;">(</tspan><tspan style="fill-opacity: .5;">)</tspan></tspan>&#160;&#160;<tspan fill="#3D7B7B" font-style="italic" style="fill-opacity: .5;">#&#160;Initialize&#160;the&#160;state</tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="33" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: .5;">output</tspan>&#160;<tspan fill="#666666" style="fill-opacity: .5;">=</tspan>&#160;<tspan style="fill-opacity: .5;"><tspan style="fill-opacity: .5;">[</tspan><tspan style="fill-opacity: .5;">]</tspan></tspan>&#160;&#160;<tspan fill="#3D7B7B" font-style="italic" style="fill-opacity: .5;">#&#160;To&#160;store&#160;final&#160;outputs&#160;for&#160;each&#160;token</tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="52" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="71" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#9467bd" font-weight="bold" style="fill-opacity: .5;">for</tspan>&#160;<tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: .5;">i</tspan>&#160;<tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: .5;">in</tspan>&#160;<tspan fill="#008000" style="fill-opacity: .5;">range</tspan><tspan style="fill-opacity: .5;">(</tspan><tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: .5;">sequence_length</tspan><tspan style="fill-opacity: .5;">)</tspan><tspan style="fill-opacity: .5;">:</tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="90" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;<tspan fill="#3D7B7B" font-style="italic" style="fill-opacity: .5;">#&#160;Compute&#160;relevance&#160;for&#160;the&#160;current&#160;position</tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="109" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;<tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: 1;">relevance</tspan>&#160;<tspan fill="#666666" style="fill-opacity: 1;">=</tspan>&#160;<tspan fill="#FF0000" font-weight="bold">compute_relevance</tspan><tspan style="fill-opacity: 1;">(</tspan><tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: 1;">Q</tspan><tspan style="fill-opacity: 1;">[</tspan><tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: 1;">i</tspan><tspan style="fill-opacity: 1;">]</tspan><tspan style="fill-opacity: 1;">,</tspan>&#160;<tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: 1;">K</tspan><tspan style="fill-opacity: 1;">,</tspan>&#160;<tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: 1;">state</tspan><tspan style="fill-opacity: 1;">)</tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="128" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;<tspan fill="#3D7B7B" font-style="italic" style="fill-opacity: .5;">#&#160;Apply&#160;normalization&#160;or&#160;weighting</tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="147" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;<tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: .5;">weights</tspan>&#160;<tspan fill="#666666" style="fill-opacity: .5;">=</tspan >&#160;<tspan style="fill-opacity: .5;">normalize</tspan><tspan style="fill-opacity: .5;">(</tspan><tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: .5;">relevance</tspan><tspan style="fill-opacity: .5;">)</tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="166" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;<tspan fill="#3D7B7B" font-style="italic" style="fill-opacity: .5;">#&#160;Update&#160;state&#160;results&#160;for&#160;the&#160;current&#160;position</tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="185" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;<tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: 1;">state</tspan>&#160;<tspan fill="#666666" style="fill-opacity: 1;">=</tspan>&#160;<tspan fill="#FF0000" font-weight="bold" style="fill-opacity: 1;">aggregate</tspan><tspan style="fill-opacity: 1;">(</tspan><tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: 1;">weights</tspan><tspan style="fill-opacity: 1;">,</tspan>&#160;<tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: 1;">V</tspan><tspan style="fill-opacity: 1;">,</tspan>&#160;<tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: 1;">state</tspan><tspan style="fill-opacity: 1;">)</tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="204" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;<tspan fill="#3D7B7B" font-style="italic" style="fill-opacity: .5;">#&#160;Store&#160;the&#160;output&#160;for&#160;the&#160;current&#160;token</tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="223" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;<tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: .5;">output</tspan><tspan fill="#666666" style="fill-opacity: .5;">.</tspan><tspan style="fill-opacity: .5;">append<tspan style="fill-opacity: .5;">(</tspan>state_to_output<tspan style="fill-opacity: .5;">(</tspan></tspan><tspan fill="#1f77b4" font-weight="bold" style="fill-opacity: .5;">state</tspan><tspan style="fill-opacity: .5;"><tspan style="fill-opacity: .5;">)</tspan><tspan style="fill-opacity: .5;">)</tspan></tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="242" xml:space="preserve"><tspan fill="#bbbbbb"></tspan></text></g></svg>
